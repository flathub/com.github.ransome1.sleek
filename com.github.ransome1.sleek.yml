app-id: com.github.ransome1.sleek
runtime: org.freedesktop.Platform
runtime-version: '20.08'
branch: stable
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '20.08'
command: run.sh
separate-locales: false
finish-args:
  - --share=ipc
  - --socket=x11
  #- --socket=pulseaudio
  - --share=network
#build-options:
#  env:
#    NPM_CONFIG_LOGLEVEL: info
sdk-extensions:
  - org.freedesktop.Sdk.Extension.node12
modules:
  #- name: nodejs
  #  cleanup:
  #    - /include
  #    - /share
  #    - /app/lib/node_modules/npm/changelogs
  #    - /app/lib/node_modules/npm/doc
  #    - /app/lib/node_modules/npm/html
  #    - /app/lib/node_modules/npm/man
  #    - /app/lib/node_modules/npm/scripts
  #  sources:
  #    - type: archive
  #      url: https://nodejs.org/dist/v12.18.3/node-v12.18.3.tar.xz
  #      sha256: 71158026579487422fd13cc2553b34cddb76519098aa6030faab52f88c6e0d0e
  - name: sleek
    build-options:
      append-path: /usr/lib/sdk/node12/bin
      #env:
        # Need this for electron-download to find the cached electron binary
        #electron_config_cache: /run/build/sleek/npm-cache/electron_cache
        #ELECTRON_CACHE: /run/build/sleek/npm-cache
    buildsystem: simple
    sources:
      - type: git
        url: https://github.com/ransome1/sleek.git
        dest: main
      #- type: file
      #  path: /flatpak/com.github.ransome1.sleek.desktop
      #- type: file
      #  path: /flatpak/com.github.ransome1.sleek.png
      - generated-sources.json
      # Wrapper to launch the app
      - type: script
        dest-filename: run.sh
        commands:
          - yarn start --prefix=/app/main
    build-commands:
      # Install npm dependencies
      #- cd main/ && npm install --offline --cache=$FLATPAK_BUILDER_BUILDDIR/npm-cache
      - cd main/ && yarn install
      # Bundle app and dependencies
      #- cd main/ && npm run pack --cache=$FLATPAK_BUILDER_BUILDDIR/npm-cache
      - cd main/ && yarn run pack
      - cp -r main/dist/linux-*unpacked /app/main
      # Install app wrapper
      - install run.sh /app/bin/
      # Install icon & .desktop
      #- install -Dm644 com.github.ransome1.sleek.png -t /app/share/icons/hicolor/512x512/apps/
      #- install -Dm644 com.github.ransome1.sleek.desktop -t /app/share/applications/
