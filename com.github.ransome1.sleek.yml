app-id: com.github.ransome1.sleek
runtime: org.freedesktop.Platform
runtime-version: '20.08'
branch: stable
sdk: org.freedesktop.Sdk
base: org.electronjs.Electron2.BaseApp
base-version: '20.08'
command: run.sh
separate-locales: false
finish-args:
  - --share=ipc
  - --socket=x11
  - --share=network
sdk-extensions:
  - org.freedesktop.Sdk.Extension.node12
#modules:
#  - name: yarn
#    buildsystem: simple
#    build-commands:
#      - 'cp -a * /app'
    # Only used for building, so clean it up afterwards.
#    cleanup:
#      - '*'
#    sources:
#      - type: archive
#        url: https://github.com/yarnpkg/yarn/releases/download/v1.19.1/yarn-v1.19.1.tar.gz
#        sha256: 34293da6266f2aae9690d59c2d764056053ff7eebc56b80b8df05010c3da9343

  - name: sleek
    build-options:
      append-path: /usr/lib/sdk/node12/bin
      env:
        ELECTRON_CACHE: /run/build/sleek/flatpak-node/electron-cache
        npm_config_nodedir: /usr/lib/sdk/node12
    buildsystem: simple
    build-commands:
#      - yarn config set cache-folder $FLATPAK_BUILDER_BUILDDIR/flatpak-node/yarn-cache
      - npm install --prefix=sleek --offline --cache=$FLATPAK_BUILDER_BUILDDIR/flatpak-node/npm-cache
      - cd /run/build/sleek/
      - . flatpak-node/electron-builder-arch-args.sh; npm run --offline dist -- $ELECTRON_BUILDER_ARCH_ARGS
    sources:
      - type: git
        url: https://github.com/ransome1/sleek.git
        commit: 29235e3f9402ea5e73b2b92052de554a471ed002
        dest: sleek
      - generated-sources.json
